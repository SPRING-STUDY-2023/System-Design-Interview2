# 1장 근접성 서비스

## 1️⃣ 문제 이해 및 설계 범위 확정

### 기능 요구사항
- 사용자의 위치(경도, 위도)와 검색 반경 정보에 매치되는 사업장 목록을 반환한다.
- 사업장 소유주가 사업장 정보를 추가/삭제/갱신할 수 있도록 하되, 그 정보가 검색 결과에 실시간으로 반영될 필요는 없다고 가정한다.
- 고객은 사업장의 상세 정보를 살필 수 있어야 한다.

<br/>

### 비기능 요구사항
- **낮은 응답 지연(latency)**: 사용자는 주변 사업장을 신속히 검색할 수 있어야 한다.
- **데이터 보호(data privacy)**: 사용자 위치는 민감한 정보다. 데이터 사생활 보호 법안을 준수하도록 한다.
- **고가용성(high availiability) 및 규모 확장성(scalability) 요구사항**: 인구 밀집 지역에서 이용자가 집중되는 시간에 트래픽이 급증해도 감당할 수 있도록 시스템을 설계해야 한다.

<br/>

### 개략적 규모 추정
- 일간 능동 사용자(DAU) : 1억명
- 등록된 사업장 수 : 2억
- 1일은 대략 10^5로 올림하여 계산하기 쉽게 사용하도록 한다. (1일 = 24시간 * 60분 * 60초 = 86,400초)
- 한 사용자는 하루에 5회 검색을 시도한다고 가정한다.
- **QPS(Query per Second)** = (1억 * 5) / 10^5 = **5,000**

<br/>

## 2️⃣ 개략적 설계안 제시 및 동의 구하기

### API 설계

> **GET /v1/search/nearby**

- 특정 검색 기준에 맞는 사업장 목록을 반환한다.
- API 호출 시 전달한 인자는 아래와 같다.
  |필드|설명|자료형|
  |---|---|---|
  |latitude|검색할 위도|decimal|
  |longitude|검색할 경도|decimal|
  |radius|optional, 기본값은 5000m|int|
- 반환되는 결과는 아래 형태와 같다.
  ```
  {
    "total": 10,
    "business": [{business object}]
  }
  ```
  - `business`: 각 사업장을 표현하는 객체

<br/>

> **사업장 관련 API**

|API|설명|
|---|---|
|GET /v1/business/:id|특정 사업장의 상세 정보 반환|
|POST /v1/business|새로운 사업장 추가|
|PUT /v1/business/:id|사업장 상세 정보 갱신|
|DELETE /v1/business/:id|특정 사업장 정보 삭제|

<br/>

### 데이터 모델

> **읽기/쓰기 비율**

- 읽기 연산은 자주 수행된다. 아래 2개 기능의 이용 빈도가 높다.
  - 주변 사업장 검색
  - 사업장 정보 확인
 
- 쓰기 연산 실행 빈도는 낮다. 사업장 정보를 추가/삭제/편집하는 행위는 빈번하지 않기 때문이다.

<br/>

> **데이터 스키마**

- business 테이블<br/><br/>
  <img alt="image" width="200" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview2/assets/55437339/776ee06f-7014-4dea-a51e-a18d9fe66a17" />

- 지리적 위치 색인 테이블
  - 위치 정보 관련 연산의 효율성을 높이는 데 쓰인다.

<br/>

### 개략적 설계안
...

<br/>

### 주변 사업장 검색 알고리즘
...

<br/>
