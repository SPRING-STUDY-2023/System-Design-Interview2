# 2장 주변 친구
앱 사용자 가운데 본인 위치 정보 접근 권한을 허락한 사용자에 한해 인근의 친구 목록을 보여주는 시스템이다.<br/>
근접성 서비스의 경우 사업장 주소는 정적이지만, 주변 친구 위치는 자주 바뀔 수 있다.

<br/>

## 1️⃣ 문제 이해 및 설계 범위 확정
### 기능 요구사항
- 사용자는 모바일 앱에서 주변 친구를 확인할 수 있어야 한다.
- 친구 목록은 몇 초마다 한 번씩 갱신되어야 한다.

<br/>

### 비기능 요구사항
- 낮은 지연 시간: 주변 친구의 위치 변화가 반영되는 데 너무 오랜 시간이 걸리지 않아야 한다.
- 안정성: 시스템은 전반적으로 안정적이어야 하지만, 때로 몇 개 데이터가 유실되는 것 정도는 용인할 수 있다.
- 결과적 일관성: 위치 데이터를 저장하기 위해 강한 일관성을 지원하는 데이터 저장소를 사용할 필요는 없다. 복제본의 데이터가 원본과 동일하게 변경되기까지 몇 초 정도 걸리는 것은 용인할 수 있다.

<br/>

### 개략적 규모 추정
- 주변 친구는 5마일(8km) 반경 이내 친구로 정의한다.
- 친구 위치 정보는 30초 주기로 갱신한다.
- 평균적으로 매일 주변 친구 검색 기능을 활용하는 사용자는 1억명으로 가정한다.
- 동시 접속 사용자의 수는 DAU 수의 10%로 가정한다.
- 평균적으로 한 사용자는 400명의 친구를 갖는다고 가정한다.
- 앱은 페이지당 20명의 주변 친구를 표시하고, 사용자의 요청이 있으면 더 많은 주변 친구를 보여 준다.

<br/>

## 2️⃣ 개략적 설계안 제시 및 동의 구하기
### 개략적 설계안

<img alt="image" width="500" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview2/assets/55437339/1c7c3e23-2e16-4151-a6a0-60f291ea97ea"/>

🔼 P2P 통신
- 이론적으로 순수한 P2P 방식으로 해결 가능하다.
- 활성 상태인 근방 모든 친구와 항구적 통신 상태를 유지하면 된다.
- 👎 통신 연결 상태가 좋지 않은 경우도 있고 사용할 수 있는 전력도 충분하지 않아서 실용적이지 않다.

<br/>

<img alt="image" width="500" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview2/assets/55437339/79b56830-4576-4846-8361-c60fb15db1fb"/>

🔼 공용 백엔드
- 좀 더 실용적인 설계안이다.
- 백엔드는 다음과 같은 역할을 수행한다.
  - 모든 활성 상태 사용자의 위치 변화 내역을 수신한다.
  - 사용자 위치 변경 내역을 수신할 때마다 해당 사용자의 모든 활성 상태 친구를 찾아서 그 친구들의 단말로 변경 내역을 전달한다.
  - 두 사용자의 사이의 거리가 특정 임계치보다 먼 경우에는 변경 내역을 전송하지 않는다.
 
- 👎 큰 규모에 적용하기 쉽지 않다.
  - 요구사항에 따르면 초당 334,000번의 위치 정보 갱신을 처리해야 한다.
  - 친구를 포함하면 초당 334,000 * 400 * 10% = 1400만 건의 위치 정보 갱신 요청을 처리해야 한다.
  - 결과적으로 엄청난 양의 갱신 내역을 사용자 단말로 보내야 한다.
 
<br/>

### 설계안
