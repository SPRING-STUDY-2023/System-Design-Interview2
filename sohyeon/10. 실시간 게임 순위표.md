# 10장 실시간 게임 순위표

## 1️⃣ 문제 이해 및 설계 범위 확정

### 기능 요구사항
- 순위표에 상위 10명의 플레이어를 표시한다.
- 특정 사용자의 순위를 표시한다.
- 어떤 사용자보다 4순위 위와 아래에 있는 사용자를 표시한다. (보너스 문제)

<br/>

### 비기능 요구사항
- 점수 업데이트는 실시간으로 순위표에 반영한다.
- 일반적인 확장성, 가용성 및 안정성 요구사항

<br/>

### 개략적 규모 추정
- 초당 평균 50명의 사용자가 게임을 플레이
  - 24시간동안 게임 중인 사용자 수가 고르게 분포된다고 가정
  - DAU가 500만 명으로 가정
 
- 최대 250명의 사용자를 감당할 수 있어야 함
  - 최대 부하는 평균의 5배로 가정
 
- 사용자 점수 획득 QPS: 500가량
  - 한 사용자가 하루 평균 10개의 게임을 플레이한다고 가정

- 최대 QPS: 2500가량
  - 500 * 5 (최대 부하 5배)
 
- 상위 10명 순위표 가져오기 QPS: 약 50
  - 각 사용자가 하루에 한 번 게임을 연다고 가정
  - 상위 10명 순위표는 사용자가 처음 게임을 열 때만 표시한다고 가정
 
<br/>

## 2️⃣ 개략적 설계안 제시 및 동의 구하기

### API 설계
- POST /v1/scores
  - 사용자가 게임에서 승리하면 순위표에서 사용자의 순위를 갱신한다.
 
- GET /v1/scores
  - 순위표에서 상위 10명의 플레이어를 가져온다.
 
- GET /v1/scores/{:user_id}
  - 특정 사용자의 순위를 가져온다.
 
<br/>

### 개략적 설계안
- 게임 서비스는 사용자가 게임을 플레이할 수 있도록 한다.
- 순위표 서비스는 순위표를 생성하고 표시하는 역할을 담당한다.

<br/>

<img alt="image" width="500" src="https://github.com/user-attachments/assets/e50e384f-d7bb-4504-8b53-bd1ca5ec7d29"/>

- 클라이언트가 순위표 서비스와 직접 통신해야 하나?
  - 위 방식은 클라이언트가 점수를 정한다.
  - 👎 중간자 공격이 가능해 보안상 안전하지 않다.
  - 점수는 서버가 설정해야 한다.

    <img alt="image" width="400" src="https://github.com/user-attachments/assets/8d13a09f-b884-42a4-9beb-03f4103839cd" />

- 게임 서비스와 순위표 서버 사이에 메시지 큐가 필요한가?
  - 해당 데이터가 다른 곳에서도 이용되거나 여러 기능을 지원해야 한다면 카프카에 데이터를 넣는 것이 합리적일 수 있다.

    <img alt="image" width="400" src="https://github.com/user-attachments/assets/f147e78e-b6d0-4d95-8262-852140509817"/>

<br/>

### 데이터 모델
