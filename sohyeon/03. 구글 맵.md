# 3장 구글 맵
## 1️⃣ 문제 이해 및 설계 범위 확정
### 기능 요구사항
- 사용자 위치 갱신
- 경로 안내 서비스 (ETA 서비스 포함)
- 지도 표시

<br/>

### 비기능 요구사항 및 제약사항
- 정확도
- 부드러운 경로 표시
- 데이터 및 배터리 사용량 (최소)
- 일반적으로 널리 통용되는 가용성 및 규모 확장성 요구사항 만족

<br/>

### 지도 101
> **측위 시스템**

<img alt="image" width="500" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview2/assets/55437339/ed872549-11ae-4e1d-8e51-9ad5b851245d"/>

🔼 위도와 경도
- **측위 시스템**은 구 표면 상의 위치를 표현하는 체계를 말한다.
- 위경도 기반 측위 시스템의 경우, 최상단에는 북극이 있고, 최하단에는 남극이 있다.
- 위도(Latitude)는 주어진 위치가 얼마나 북쪽/남쪽인지를 나타낸다.
- 경도(Longitude)는 얼마나 동쪽/서쪽인지를 나타낸다.

<br/>

> **3차원 위치의 2차원 변환**

<img alt="image" width="500" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview2/assets/55437339/2c527e8c-b4d9-4ff6-baea-7a8cd1a8a0ee"/>

🔼 지도 투영법 사이의 차이점
- 3차원 구 위의 위치를 2차원 평면에 대응시키는 절차를 **지도 투영법** 또는 **도법**이라 부른다.
- 거의 모든 투영법은 실제 지형의 기하학적 특성을 왜곡한다는 공통점을 갖는다.
- 구글 맵은 메르카토르 도법을 조금 변경한 **웹 메르카토르** 도법을 택하고 있다.

<br/>

> **지오코딩**

- **지오코딩**은 주소를 지리적 측위 시스템의 좌표로 변환하는 프로세스다.

<br/>

> **지오해싱**

<img alt="image" width="500" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview2/assets/55437339/a8640c1a-048c-4db9-8395-08909e64940c" />

🔼 지오해싱
- **지오해싱**은 지도 위 특정 영역을 영문자와 숫자로 구성된 짧은 문자열에 대응시키는 인코딩 체계다.
- 2차원의 평면 공간으로 표현된 지리적 영역 위의 격자를 더 작은 격자로 재귀적으로 분할해 나간다.

<br/>

> **지도 표시**

- 지도 전부를 하나의 이미지로 표시하는 대신, 작은 타일로 쪼개어 표시한다.
- 클라이언트는 현재 보려는 지도 확대 수준에 근거하여 어떤 크기의 타일을 가져올지 고른다.

<br/>

> **경로 안내 알고리즘을 위한 도로 데이터 처리**

<img alt="image" width="500" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview2/assets/55437339/99396d3a-adef-41e8-affb-1e8aafc6910d"/>

🔼 그래프로 표현한 지도
- 모든 경로 탐색 알고리즘은 교차로를 노드(node)로, 도로는 노드를 잇는 선(edge)으로 표현하는 그래프 자료 구조를 가정한다.
- 좋은 성능을 위해 그래프를 관리 기능 단위로 분할할 필요가 있다. (각 격자는 경로 안내 타일이라 부름)
- 도로망을 언제든 불러올 수 있는 경로 안내 타일로 분할해 놓으면 경로 탐색 알고리즘이 동작하는 데 필요한 메모리 요구량을 낮출 수 있고, 한번에 처리해야 하는 경로의 양이 줄어들며, 필요한만큼만 불러오면 되기 때문에 탐색 성능도 좋아진다.

<br/>

> **계층적 경로 안내 타일**

- 구체성 정도를 상, 중, 하로 구분하여 3가지 종류의 경로 안내 타일을 준비한다.
  - 가장 구체성이 높은 타일의 경우(**상**), 그 크기는 아주 작으며, 이런 타일에는 지방도 데이터만 둔다.
  - **중**은 더 넓은 지역을 커버하며, 규모가 비교적 큰 관할구를 잇는 간선 도로 데이터만 둔다.
  - 구체성이 가장 낮은 타일(**하**)은 그보다 더 큰 영역을 커버하며, 그런 타일에는 도시와 주를 연결하는 주요 고속 도로 데이터만 둔다.
 
<br/>

<img alt="image" width="500" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview2/assets/55437339/03637ac0-6967-4808-b120-cc98ac2056aa" />

🔼 크기가 서로 다른 경로 안내 타일

<br/>

### 개략적 규모 추정

> **저장소 사용량**

- 세계 지도
  - 지도를 최대한 확대하여(zoom in) 보는 데 필요한 타일 개수를 따져보면 좋다.
  - 확대할 때마다 하나의 타일을 4장의 타일로 펼친다고 하면, 21번 최대 확대로 약 4.4조개의 파일이 필요하다.
  - 한 장의 타일이 압축 PNG 파일이라면 한 장당 100KB의 저장 공간이 필요하다.
  - 최대 확대 시 필요 타일을 전부 저장하려면 4.4조 * 100KB = 440PB만큼의 저장 공간이 필요할 것이다.
  - 지구 표면 가운데 90%는 인간이 살지 않는 자연 그대로임을 감안하면 44~88PB 가량으로 볼 수 있다. (어림잡아 50PB)
  - 다양한 확대 수준으로 지도를 표시하기 위해 대략 100PB 정도가 소요될 것이다.
 
- 메타데이터(metadata)
  - 크기가 아주 작아서 무시해도 지장이 없을 정도이다.
 
- 도로 정보
  - 요구사항을 통해 수 TB 용량의 도로 데이터를 보유하고 있음을 알 수 있다.
 
<br/>

> **서버 대역폭**

- 경로 안내 요청: QPS = 20만 (10억 DAU)
- 위치 갱신 요청: QPS = 200,000 * 5 = 1백만 (평균치의 5배 가량으로 가정)

<br/>

## 2️⃣ 개략적 설계안 제시 및 동의 구하기
