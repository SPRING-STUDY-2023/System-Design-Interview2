# 9장 S3와 유사한 객체 저장소

## 저장소 시스템 101

### 블록 저장소
- 원시 블록(raw block)을 서버에 볼륨(volume) 형태로 제공한다.
- 가장 유용하고 융통성이 높은 저장소다.
- 서버에 물리적으로 직접 연결되는 저장소에 국한되지 않는다.

<br/>

### 파일 저장소
- 블록 저장소 위에 구현된다. (더 높은 추상화 제공)
- 가장 널리 사용되는 범용 저장소 솔루션이다.
- 파일 저장소를 사용하는 서버는 블록을 직접 제어하고, 볼륨을 포맷하는 등의 까다로운 작업을 신경 쓸 필요없다.
- 단순하기 때문에 폴더나 파일을 같은 조직 구성원에 공유하는 솔루션으로 사용하기 좋다.

<br/>

### 객체 저장소
- 데이터 영속성을 높이고 대규모 애플리케이션을 지원하며, 비용을 낮추기 위해 의도적으로 성능을 희생한다.
- 상대적으로 차가운(cool) 데이터 보관에 초점을 맞추며 데이터 아카이브나 백업에 주로 쓰인다.
- 모든 데이터를 수평적 구조 내에 객체로 보관한다.
- 데이터 접근은 보통 RESTful API를 통한다. (상대적으로 느림)
- ex. AWS S3, Azure Blob Storage

<br/>

## 1️⃣ 문제 이해 및 설계 범위 확정

### 기능 요구사항
- 버킷 생성
- 객체 업로드 및 다운로드
- 객체 버전
- 버킷 내 객체 목록 출력 기능

<br/>

### 비기능 요구사항
- 100PB 데이터
- 식스 나인 수준의 데이터 내구성
- 포 나인 수준의 서비스 가용성
- 저장소 효율성: 높은 수준의 안정성과 성능은 보증하되 저장소 비용은 최대한 낮추어야 함

<br/>

### 대략적인 규모 추정
- 디스크 용량
  - 20%: 1MB 미만
  - 60%: 1MB ~ 64MB
  - 20%: 64MB 이상
 
- IOPS: 하드 디스크 하나가 초당 100~150회의 임의 데이터 탐색을 지원할 수 있다고 가정
- 저장소에 수용 가능한 객체 수: 100PB (0.68TB 정도의 공간 필요)

<br/>

## 2️⃣ 개략적 설계안 제시 및 동의 구하기
- 객체 불변성
- 키-값 저장소
- 저장은 1회, 읽기는 여러 번
- 소형 및 대형 객체 동시 지원

<br/>

### 개략적 설계안

<img alt="image" width="500" src="https://github.com/user-attachments/assets/16f45d21-5783-4713-8a87-6d38d9df879c"/>

- 로드밸런서: 요청을 서버들에 분산
- API 서비스: 인증, 권한 부여, 접근 제어 등을 중앙에서 맡아 처리
- 데이터 저장소: 실제 데이터를 보관하고 필요할 때마다 읽어가는 장소
- 메타데이터 저장소: 객체 메타데이터 보관 장소

<br/>

### 객체 업로드

<img alt="image" width="500" src="https://github.com/user-attachments/assets/35d59c1d-46d7-4557-ba66-3ced5fc9d65a"/>

- 객체는 버킷 안에 두어야 한다.
- 예제에서는 bucket-to-share라는 버킷 생성 후 파일 script.txt 파일을 업로드한다.
- 과정은 크게 7단계로 나누어진다.

<br/>

### 객체 다운로드

<img alt="image" width="500" src="https://github.com/user-attachments/assets/3d0dd078-3c07-4e08-aecd-88611e769e00"/>

- 버킷은 디렉터리 같은 계층 구조를 지원하지 않는다.
- 버킷 이름과 객체 이름을 연결하여 논리적 계층을 만들 수 있다. (ex. bucket-to-share/script.txt)

<br/>

## 3️⃣ 상세 설계
